// COMPRAR
function directBuy() {
    $("<p id='limite' style='visibility:hidden;'></p>").insertAfter("div#preco a.buy-button.buy-button-ref");
    $('#mais').click(function() {
        value = $('#qtd-input').find('input').val();
        value = parseInt(value);
        if (value >= skuJson_0.skus[0].availablequantity) {
            $('#qtd-input').find('input').val(value);
            href = $('body').find('a.buy-button.buy-button-ref').attr('href');
            href = href.replace('qty=' + (value - 1), 'qty=' + (value));
            $('body').find('a.buy-button.buy-button-ref').attr('href', href);
            $("p#limite").html("No momento existem " + skuJson_0.skus[0].availablequantity + " unidades no estoque").css("visibility", "visible");
        } else {
            value++;
            $('#qtd-input').find('input').val(value);
            href = $('body').find('a.buy-button.buy-button-ref').attr('href');
            href = href.replace('qty=' + (value - 1), 'qty=' + (value));
            $('body').find('a.buy-button.buy-button-ref').attr('href', href);
        }

    });
    $('#menos').click(function() {
        value = $('#qtd-input').find('input').val();
        value = parseInt(value);

        if (value > 1) {
            value--;
            $('#qtd-input').find('input').val(value);
            href = $('body').find('a.buy-button.buy-button-ref').attr('href');
            href = href.replace('qty=' + (value + 1), 'qty=' + (value));
            $('body').find('a.buy-button.buy-button-ref').attr('href', href);
        }
    });
    var $width = $(window).width();
    if ($width > 1024) {
        jQuery(function($) {
            $("div#top-right a.buy-button").click(function(e) {
                e.preventDefault();
                var comprarUrl = $(this).attr("href");
                if (comprarUrl === "javascript:alert('Por favor, selecione o modelo desejado.');") {
                    alert("Por favor, selecione o modelo desejado");
                } else {
                    $("html, body").animate({
                        scrollTop: 0
                    }, "fast");
                    var hrefCart = $("div#top-right .buy-button").attr("href");
                    var qtd = $("div#qtd-input input").val();
                    var res = hrefCart.replace(/qty=1/, "qty=" + qtd);
                    var resURL = res.split("sku=").pop().split("&qty=").shift();
                    item = {
                        id: resURL,
                        quantity: qtd,
                        seller: 1
                    };
                    vtexjs.checkout.getOrderForm().then(function(orderForm) {
                        vtexjs.checkout.addToCart([item]).done(function(orderForm) {
                            gtmCart.listCart(orderForm);
                        });
                    });
                    $("div#ajaxBusy").fadeIn("fast").fadeOut("slow");
                    $("div#minicart").css("display", "table");
                    //$("div#minicart").fadeIn("fast").fadeOut(10000);
                }
            });
        });
    }
}
//
// COMPRE JUNTO
function compreJuntoNovo() {
    if ($("body").find("td.itemA").length) {
        $("<div id='compre-junto-novo'><h2>Aproveite e Compre Junto</h2><ul></ul></div>").insertAfter("div#compre-junto");
        var itemA = $("div#divCompreJunto table tr:eq(0) td.itemA").html();
        var plus = $(".buy-together-content .plus").html();
        var equal = $(".buy-together-content .equal").html();
        $("<div id='itemA'><div id='itemA-image'>" + itemA + "</div></div><div id='plus'>" + plus + "</div>").insertAfter("div#compre-junto-novo > h2");
        //$("div#divCompreJunto table tr:not(:eq(0)) td.itemA").remove();


        $("div#divCompreJunto table tr").each(function() {
            var itemB = $(this).find(".itemB").html();
            var buy = $(this).find(".buy").html();
            $("div#compre-junto-novo ul").append("<li><div><div class='itemB-image'>" + itemB + "</div><div id='equal'>" + equal + "</div><div class='itemB-buy'>" + buy + "</div></div></li>");
        });
        $("div#divCompreJunto").remove();
        $("div#compre-junto-novo ul").addClass("slick-compre-junto");
        $('.slick-compre-junto').slick({
            dots: true,
            arrows: true,
            infinite: false,
            variableWidth: false,
            slidesToShow: 1,
            mobileFirst: true,
            slidesToScroll: 1
        });
    }
    $("div#compre-junto-novo").css("visibility", "visible");
};
//
// IMAGEM AVALIACAO
function avaliacao() {
    var imagem = $("#image-main").attr("src");
    $("#opnioes-dos-clientes").prepend("<div id='resenha-img'><img src='" + imagem + "' /></div>");
    $(".user-review h4").prependTo("#opnioes-dos-clientes");
}
//
// DESCONTO
/*function descontoProduto() {
    if ($("body").find(".skuBestPrice").length) {
        var $this = $(".skuBestPrice");
        var a = $($this).html().split(" ")[1];
        if (a.length < 7) {
            var b = a.replace(",", ".");
            var c = b * 0.95;
            var d = c.toFixed(2);
            var e = d.replace(".", ",");
            $("body").find('p.preco-a-vista strong.skuPrice').html(e);
        } else {
            var b = a.replace(".", "");
            var bb = b.replace(",", ".");
            var c = bb * 0.95;
            var d = c.toFixed(2);
            var e = d.replace(".", ",");
            $("body").find('p.preco-a-vista strong.skuPrice').html(e);
        }
        var test = $("body").find("p.preco-a-vista strong.skuPrice").html();

        function getMoney(str) {
            return parseInt(str.replace(/[\D]+/g, ''));
        }

        function formatReal(int) {
            var tmp = int + '';
            tmp = tmp.replace(/([0-9]{2})$/g, ",$1");
            if (tmp.length > 6)
                tmp = tmp.replace(/([0-9]{3}),([0-9]{2}$)/g, ".$1,$2");

            return tmp;
        }
        var int = getMoney(test);
        $("body").find("p.preco-a-vista strong.skuPrice").html("<div><span>Ou R$ " + formatReal(int) + " no boleto</span></div>");
        $("p.preco-a-vista.price-cash").css("visibility", "visible");
    }
};*/
//
function montaCores() {
    var $nome,$nome1;
  $(".topic.Cordalente label, .topic.Cordasborrachas label,.topic.Cor label").each(function() {
    $nome = $(this).html();
    $nome1 = $nome.replace(/ /g, "");
    if ($nome == 'Estampa Única') {
      $(".topic label:contains('" + $nome + "')").css("font-size", "15px").css("height", "45px").css("width", "100px");

    } else {
      $(".topic label:contains('" + $nome + "')").css("background-image", "url(/arquivos/" + $nome1 + ".png)");
    }
    $(this).attr("title",$nome);
  });

}
$(document).ready(function() {
    ShippingValue();
    directBuy();
    montaCores();
    if($("body").find("span#par").length){
    	$("div#qtd>span").html("QUANTIDADE EM PARES");
    }
    //setTimeout(avaliacao, 1000);
    /*$("ul.Tipodalente input").change(function(){
        $("ul.Cordalente li.select").addClass("open");
    });
    $("ul.Cordalente").click(function(){
        $("ul.Cordalente li.select").addClass("open");
    })*/
    setTimeout(function(){
        $("input#btnFreteSimulacao").attr("value","Calcular");
        //$("ul.Tipodalente label:eq(0)").click();
    },300);

    $(document).on("click","input#btnFreteSimulacao",function(){
        /* 23170250 */
        var frete, titulo;
        setTimeout(function(){
            $(".freight-values tbody tr").each(function(){
                titulo = $(this).find("td:eq('0')").html();

                if(titulo.split(" ")[1] != undefined){
                    titulo = "Retirada na Loja";
                }

                frete = $(this).find("td:eq('1')").html();
                frete = frete.split(" para")[0];

                if(frete.split("RJ, entrega")[1] != undefined){
                    frete = frete.split("RJ, entrega")[0] + " Disponível para retirada " + frete.split("RJ, entrega")[1];
                }

                /*console.log(frete);
                console.log(titulo);*/

                $(this).find("td:eq('0')").html(titulo);
                $(this).find("td:eq('1')").html(frete);
                $(".freight-values").css("visibility","visible");
            });
        },1000);
    })
    
});
$(document).ajaxStop(function(){
    setTimeout(compreJuntoNovo, 200);
})